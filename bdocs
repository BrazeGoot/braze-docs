#!/bin/bash

# This is a bash script for interacting with the various files in './scripts/'.
# 
# Usage: ./bdocs [option]

set -e

# The project's root directory.
export PROJECT_ROOT
PROJECT_ROOT="$(dirname "$(realpath "$0")")"

# Displays usage for bdocs
display_help() {
    cat << EOF
bdocs - a [b]raze [docs] utility that lets you execute or learn about tools in the ./scripts directory.

Usage: ./bdocs [option]

Options:
  deploy       Create the deploy body text for weekly deployments
  release      Create the release body text for monthly releases
  rrl          Remove unused reference links in one or more Markdownfile files
  crl          Convert and remove reference links from one or more Markdownfile files
  help         Display this help message and exit

EOF
}

# Check if no arguments were provided
if [[ $# -eq 0 ]]; then
    display_help
    exit 1
fi

# Argument parsing
case $1 in
    deploy)
        if [[ $# -eq 3 ]]; then
            "$PROJECT_ROOT/scripts/deploy_text.sh" "$2" "$3"
        else
            "$PROJECT_ROOT/scripts/deploy_text.sh"
        fi
        ;;
    release)
        "$PROJECT_ROOT/scripts/release_text.sh"
        ;;
    rrl)
        if [[ -z "$2" ]]; then
            echo "Error: Path to file or directory is required."
            exit 1
        fi
        ruby "$PROJECT_ROOT/scripts/remove_unused_reference_links.rb" "$2"
        ;;
    crl)
        if [[ -z "$2" ]]; then
            echo "Error: Path to file or directory is required."
            exit 1
        fi
        python3 "$PROJECT_ROOT/scripts/convert_reference_links.py" "$2"
        ruby "$PROJECT_ROOT/scripts/remove_unused_reference_links.rb" "$2"
        ;;
    help)
        display_help
        ;;
    *)
        echo "Invalid option: $1. To see all options, run: ./bdocs help"
        exit 1
        ;;
esac
